# サブルーチン

## サブルーチンとは?
- プログラムの中で, 意味や内容がまとまっている作業をひとかたまりにしたものを｢サブルーチン｣と呼びます.
- Perlにおける｢サブルーチン｣は, ｢関数｣とほぼ同義です.

## 組み込み関数
- Perlには, これまで使ってきた`print`や`join`など, Perlが提供する関数(組み込み関数)が用意されています
- サブルーチンを使うことで, `print`や`join`のように, ｢特定の処理をするコード｣をひとかたまりにして, 簡単に呼ぶことが出来るようになります.

## サブルーチンの定義
- それでは, 早速サブルーチンを定義していきましょう.
- 今回は, 末尾に自動的に改行(`\n`)を付与しながら文字列を表示する`say`というサブルーチンを定義してみます.

## サブルーチンの定義

    sub say {
        my $str = shift @_;
        print "$str\n";     
    }
    say("hello, world!"); # => hello, world![改行]

- それでは, 詳しく見て行きましょう.

## サブルーチンの定義
    sub say { ... }

- Perlでサブルーチンを定義する為には, `sub サブルーチン名 { ... }`と書きます.
- 末尾の`}`の後に, `;`を書く必要はありません.
- サブルーチン名として使える文字は大文字･小文字の英数字と, アンダースコア(`_`)です.
    - 但し, サブルーチン名の先頭は英文字か`_`でなければなりません.

## サブルーチンの定義

    sub output_data { ... }

- 複数の単語でサブルーチン名を構築する時は, このように単語どうしを`_`で繋げる(スネークケース)場合が多いです.

## クイズ 

    sub hoge!    { ... } 
    sub _hoge    { ... }
    sub 1hoge    { ... }
    sub hoge_123 { ... }

- この中で, サブルーチン名として正しいものはどれでしょうか ?

## 正解は?

    sub hoge!    { ... } # => '!'はサブルーチン名に使えない
    sub _hoge    { ... }
    sub 1hoge    { ... } # => 先頭は英字or'_'
    sub hoge_123 { ... }

- 正解は`_hoge`と`hoge_123`です.

## サブルーチンの呼び出し

    say('hoge');

- 定義したサブルーチンは, 定義したサブルーチン名の後ろに`()`を付けることで呼び出せます.
- サブルーチンに値(引数)を渡したい場合, `()`の中に書きます.
- `()`を使わずに, 先頭に`&`を付けて`&say`で呼びだすこともできますが, 古い書き方なので使わないようにしましょう.

## サブルーチンの引数 
    sub say {
        my $str = shift @_; # @_ => ('hoge')
        ...
    }
    say('hoge');

- サブルーチンに与えられた引数は, `@_`という配列(無名配列)に格納されます.
- 2行目では, `shift`を使って, この`@_`の先頭の要素を取得しています.
- このサブルーチンを`say('hoge');`のように呼んだ場合, `@_`の中身は`('hoge')`になるので, `$str`には`hoge`という文字列が入ります.

## サブルーチンの引数
    sub say {
        my $str = shift;
        ...
    }

- サブルーチンに与えられた引数が格納されている`@_`は, 省略することができます.
- その為, 2行目の`my $str = shift;`は, `my $str = shift @_;`と同じ意味になります.

## サブルーチン｢add｣

    sub add {
        my ($left, $right) = @_;
        return $left + $right;
    }
    my $result = add(2, 5);

- 次に, 2つの引数を受け取り, その和を返すサブルーチン`add`を考えてみることにします.
- `add`サブルーチンの定義と呼び出しは, このように書くことができます.

## サブルーチンの引数

    sub add {
        my ($left, $right) = @_;
        ... 
    }
    my $result = add(2, 5);

- サブルーチンに複数の引数が与えられた場合(この場合は`2`と`5`), サブルーチン側ではこのようにして受け取ることができます.
    - サブルーチンに複数の引数を与える時は, (配列のように)`,`で区切って渡します.

## サブルーチンの引数

    sub add {
        my $left  = shift;
        my $right = shift;
        ... 
    }

- 先程の引数の受け取り方は, 上記のコードと同じ意味になります.

## サブルーチンの返り値

    sub add {
        my ($left, $right) = @_;
        return $left + $right;
    }
    my $result = add(2, 5);

- サブルーチンは, `return`を使うことで, 任意のデータを呼び出し元へ返すことができます.
    - この場合, `$left + $right`の計算結果が, 呼び出し元へ返され, `$result`に格納されます. 

## 複数個のreturn

    sub same {
        my ($i, $j) = @_;
        if ($i == $j) {
            print "true\n"; # $i == $jなら表示
            return 1;
        } else {
            print "false\n"; # $i != $jなら表示
            return 0;
        }
        print "!?\n"; # 絶対に表示されない!
        return undef;
    }

- `return`はサブルーチンの中に複数個書くことができますが, `return`に到達した場合, それ以降の処理は一切行われず, すぐさま値を返してサブルーチンの実行を終了します.

## 複数の返り値

    sub calc {
        my ($left, $right) = @_;
        return ($left + $right, $left - $right);
    }
    my ($add, $min) = calc(5, 4);

- サブルーチンは, このようにリストを返すことで, 複数個の値を返すこともできます.

## returnがない場合の返り値

    sub add {
        my ($left, $right) = @_;
        $left + $right;
    }

- サブルーチンの中に`return`がない場合, サブルーチンの返り値は, 最後に評価された処理の結果(この場合, `$left + $right`の計算結果)を返します.

## 練習問題
- 次のような機能を持つコードを, `simple_calc.pl`という名前で作成しよう.
    - 2つの引数の和を計算する`add`と同様に, 2つの引数の差を計算する`min`, 積を計算する`mul`, 商を計算する`div`というサブルーチンを作ってみよう.
    - これらのサブルーチンが正しく実装できているか(与えた2つの引数に対して, 適切な値を返すか)を確認するコードを書いてみよう.
